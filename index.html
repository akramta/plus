<!-- <!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ÙˆØ§Ø¬Ù‡Ø© Chatbot FastAPI</title>
    <style>
      :root {
        --bg: #0f172a;
        --panel: #111827;
        --panel-2: #1f2937;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --accent: #22d3ee;
        --accent-2: #06b6d4;
        --good: #10b981;
        --bad: #ef4444;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto,
          "Noto Naskh Arabic", Tahoma, Arial, sans-serif;
        background: radial-gradient(
            1200px 600px at 80% -10%,
            #164e63 0%,
            transparent 60%
          ),
          var(--bg);
        color: var(--text);
      }
      .container {
        max-width: 900px;
        margin: 40px auto;
        padding: 24px;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.04),
          rgba(255, 255, 255, 0.02)
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 20px;
        padding: 24px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        backdrop-filter: blur(6px);
      }
      h1 {
        margin: 0 0 8px;
        font-size: clamp(22px, 3vw, 30px);
      }
      p.lead {
        margin: 0 0 18px;
        color: var(--muted);
      }
      #messages {
        height: 320px;
        overflow-y: scroll;
        padding: 12px;
        border-radius: 12px;
        background: var(--panel);
        border: 1px solid rgba(255, 255, 255, 0.08);
        margin-bottom: 16px;
        display: flex;
        flex-direction: column;
        scrollbar-width: thin; /* Firefox */
        scrollbar-color: var(--accent) var(--panel); /* Firefox */
      }
      #messages::-webkit-scrollbar {
        width: 8px;
      }
      #messages::-webkit-scrollbar-track {
        background: var(--panel);
        border-radius: 12px;
      }
      #messages::-webkit-scrollbar-thumb {
        background: var(--accent);
        border-radius: 12px;
      }
      .msg {
        margin: 8px 0;
        padding: 10px 14px;
        border-radius: 16px;
        max-width: 80%;
        word-wrap: break-word;
      }
      .user {
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        color: #111827;
        align-self: flex-end;
        margin-left: auto;
      }
      .bot {
        background: var(--panel-2);
        color: var(--text);
        align-self: flex-start;
        margin-right: auto;
      }
      form {
        display: flex;
        gap: 10px;
      }
      input {
        flex: 1;
        height: 44px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: var(--panel-2);
        color: var(--text);
        padding: 0 14px;
        outline: none;
      }
      input:focus {
        border-color: var(--accent);
      }
      button {
        cursor: pointer;
        border: none;
        font-weight: 600;
        transition: transform 0.06s ease, background 0.2s ease;
        background: linear-gradient(90deg, var(--accent), var(--accent-2));
        padding: 0 18px;
        border-radius: 12px;
      }
      button:hover {
        transform: translateY(-1px);
      }
      .button-group {
        margin-top: 12px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .footer {
        margin-top: 12px;
        color: var(--muted);
        font-size: 13px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>ÙˆØ§Ø¬Ù‡Ø© Chatbot FastAPI</h1>
        <p class="lead">
          Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ù„Ø¨ÙˆØª ÙˆØ³ÙŠÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø±Ø¯ Ù…Ø¨Ø§Ø´Ø±Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ù…Ø§Ø¹ Ø§Ù„Ø±Ø¯ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„
          Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©.
        </p>

        <div id="messages"></div>

        <form id="chat-form">
          <input
            type="text"
            id="question"
            placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
            required
          />
          <button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
        </form>

        <div class="button-group">
          <button id="speakBtn" type="button">ğŸ”Š Ø³Ù…Ø§Ø¹ Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨ÙˆØª</button>
          <button id="downloadBtn" type="button">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
        </div>

        <div class="footer">
          Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø®Ø§Ø¯Ù… FastAPI ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„ØµØ­ÙŠØ­.
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById("chat-form");
      const input = document.getElementById("question");
      const messagesDiv = document.getElementById("messages");
      const speakBtn = document.getElementById("speakBtn");
      const downloadBtn = document.getElementById("downloadBtn");

      let chatHistory = [];

      function addMessage(text, role) {
        const div = document.createElement("div");
        div.className = "msg " + role;
        div.textContent = text;
        messagesDiv.appendChild(div);
        messagesDiv.scrollTop = messagesDiv.scrollHeight; // ØªÙ…Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ
        if (role === "bot") chatHistory.push("Bot: " + text);
        else chatHistory.push("You: " + text);
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const question = input.value.trim();
        if (!question) return;
        addMessage(question, "user");
        input.value = "";

        try {
          const formData = new FormData();
          formData.append("question", question);

          const res = await fetch("http://127.0.0.1:8000/ask", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          addMessage(data.answer, "bot");
        } catch (err) {
          addMessage("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….", "bot");
          console.error(err);
        }
      });

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") form.dispatchEvent(new Event("submit"));
      });

      // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ù„Ø¨ÙˆØª (Text-to-Speech)
      speakBtn.addEventListener("click", () => {
        const lastBotMsg = chatHistory
          .filter((m) => m.startsWith("Bot:"))
          .pop();
        if (!lastBotMsg) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨ÙˆØª Ø¨Ø¹Ø¯.");
        const utterance = new SpeechSynthesisUtterance(
          lastBotMsg.replace("Bot: ", "")
        );
        utterance.lang = "ar-SA";
        speechSynthesis.speak(utterance);
      });

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙƒÙ…Ù„Ù Ù†ØµÙŠ
      downloadBtn.addEventListener("click", () => {
        if (chatHistory.length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§.");
        const blob = new Blob([chatHistory.join("\n")], {
          type: "text/plain;charset=utf-8",
        });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "chat_history.txt";
        a.click();
        URL.revokeObjectURL(a.href);
      });
    </script>
  </body>
</html> -->





<!-- <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatbot Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</title>
<style>
  body { font-family: Arial, sans-serif; background:#0f172a; color:#fff; margin:0; padding:0; }
  #chat-container { max-width:600px; margin:50px auto; padding:20px; background:#111827; border-radius:10px; }
  #messages { height:400px; overflow-y:auto; padding:10px; border:1px solid #333; border-radius:5px; margin-bottom:10px; }
  .msg { margin:5px 0; padding:8px 12px; border-radius:8px; }
  .user { background:#2563eb; text-align:right; }
  .bot { background:#1f2937; text-align:left; }
  input, button { padding:10px; margin:5px 0; border-radius:5px; border:none; }
  button { cursor:pointer; background:#2563eb; color:#fff; }
</style>
</head>
<body>
<div id="chat-container">
  <div id="messages"></div>
  <form id="chat-form">
    <input type="text" id="question" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." autocomplete="off"/>
    <button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
  </form>
  <button id="speakBtn">ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ù„Ø¨ÙˆØª</button>
  <button id="downloadBtn">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
</div>

<script>
const form = document.getElementById("chat-form");
const input = document.getElementById("question");
const messagesDiv = document.getElementById("messages");
const speakBtn = document.getElementById("speakBtn");
const downloadBtn = document.getElementById("downloadBtn");

let chatHistory = [];

function addMessage(text, role, clear = true) {
  let div;
  if (clear) {
    div = document.createElement("div");
    div.className = "msg " + role;
    messagesDiv.appendChild(div);
  } else {
    div = messagesDiv.lastChild;
  }
  div.textContent += text;
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  if (role === "bot" && clear) chatHistory.push("Bot: " + text);
  else if (role === "user" && clear) chatHistory.push("You: " + text);
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const question = input.value.trim();
  if (!question) return;
  addMessage(question, "user");
  input.value = "";

  try {
    const formData = new FormData();
    formData.append("question", question);

    const res = await fetch("http://127.0.0.1:8000/ask", {
      method: "POST",
      body: formData,
    });
    const data = await res.json();

    // Ù…Ø­Ø§ÙƒØ§Ø© streaming Ø­Ø±Ù Ø­Ø±Ù
    let answer = data.answer;
    let i = 0;
    function typeWriter() {
      if (i < answer.length) {
        addMessage(answer[i], "bot", i===0 ? true : false);
        i++;
        setTimeout(typeWriter, 30); // ÙƒÙ„ 30 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ© Ø­Ø±Ù Ø¬Ø¯ÙŠØ¯
      }
    }
    typeWriter();

  } catch (err) {
    addMessage("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….", "bot");
    console.error(err);
  }
});

input.addEventListener("keydown", (e) => {
  if (e.key === "Enter") form.dispatchEvent(new Event("submit"));
});

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ù„Ø¨ÙˆØª (Text-to-Speech)
speakBtn.addEventListener("click", () => {
  const lastBotMsg = chatHistory.filter((m) => m.startsWith("Bot:")).pop();
  if (!lastBotMsg) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨ÙˆØª Ø¨Ø¹Ø¯.");
  const utterance = new SpeechSynthesisUtterance(lastBotMsg.replace("Bot: ", ""));
  utterance.lang = "ar-SA";
  speechSynthesis.speak(utterance);
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙƒÙ…Ù„Ù Ù†ØµÙŠ
downloadBtn.addEventListener("click", () => {
  if (chatHistory.length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§.");
  const blob = new Blob([chatHistory.join("\n")], { type: "text/plain;charset=utf-8" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "chat_history.txt";
  a.click();
  URL.revokeObjectURL(a.href);
});
</script>
</body>
</html> -->



<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatbot Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</title>
<style>
  :root {
    --bg: #0f172a;
    --panel: #111827;
    --panel-2: #1f2937;
    --text: #e5e7eb;
    --muted: #9ca3af;
    --accent: #22d3ee;
    --accent-2: #06b6d4;
  }

  body {
    margin:0;
    font-family: "Segoe UI", Tahoma, Arial, sans-serif;
    background: radial-gradient(1200px 600px at 80% -10%, #164e63 0%, transparent 60%), var(--bg);
    color: var(--text);
  }

  #chat-container {
    max-width: 700px;
    margin: 50px auto;
    padding: 24px;
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    backdrop-filter: blur(6px);
  }

  h1 {
    margin:0 0 8px;
    font-size: clamp(22px,3vw,30px);
  }

  p.lead {
    margin:0 0 18px;
    color: var(--muted);
  }

  #messages {
    height: 320px;
    overflow-y: auto;
    padding: 12px;
    border-radius: 12px;
    background: var(--panel);
    border: 1px solid rgba(255,255,255,0.08);
    margin-bottom: 16px;
    display: flex;
    flex-direction: column;
  }

  #messages::-webkit-scrollbar {
    width: 8px;
  }
  #messages::-webkit-scrollbar-track {
    background: var(--panel);
    border-radius: 12px;
  }
  #messages::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 12px;
  }

  .msg {
    margin: 8px 0;
    padding: 10px 14px;
    border-radius: 16px;
    max-width: 80%;
    word-wrap: break-word;
  }

  .user {
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    color: #111827;
    align-self: flex-start;
  }

  .bot {
    background: var(--panel-2);
    color: var(--text);
    align-self: flex-end;
  }

  form {
    display: flex;
    gap: 10px;
  }

  input {
    flex: 1;
    height: 44px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    background: var(--panel-2);
    color: var(--text);
    padding: 0 14px;
    outline: none;
  }

  input:focus {
    border-color: var(--accent);
  }

  button {
    cursor:pointer;
    border:none;
    font-weight:600;
    transition: transform 0.06s ease, background 0.2s ease;
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    padding: 0 18px;
    border-radius: 12px;
  }

  button:hover {
    transform: translateY(-1px);
  }

  .button-group {
    margin-top:12px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }

  .footer {
    margin-top:12px;
    color: var(--muted);
    font-size:13px;
    text-align:center;
  }
</style>
</head>
<body>
<div id="chat-container">
  <h1>
    âš¡
    Ø¨ÙˆØª Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ 
    ğŸ¤– 
  </h1>
  <p class="lead">
Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù„Ù„Ø¨ÙˆØª ÙˆØ³ÙŠØ¬ÙŠØ¨ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¡ âš¡. 
  ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ù…Ø§Ø¹ Ø§Ù„Ø±Ø¯ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©.<br>
  </p>

  <div id="messages"></div>

  <form id="chat-form">
    <input type="text" id="question" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." required />
    <button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
  </form>

  <div class="button-group">
    <button id="speakBtn" type="button">ğŸ”Š Ø³Ù…Ø§Ø¹ Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨ÙˆØª</button>
    <button id="downloadBtn" type="button">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
  </div>

  <div class="footer">
    Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø®Ø§Ø¯Ù… FastAPI ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° Ø§Ù„ØµØ­ÙŠØ­.
  </div>
</div>

<script>
const form = document.getElementById("chat-form");
const input = document.getElementById("question");
const messagesDiv = document.getElementById("messages");
const speakBtn = document.getElementById("speakBtn");
const downloadBtn = document.getElementById("downloadBtn");

let chatHistory = [];

function addMessage(text, role, clear=true) {
  let div;
  if(clear) {
    div = document.createElement("div");
    div.className = "msg " + role;
    messagesDiv.appendChild(div);
  } else {
    div = messagesDiv.lastChild;
  }
  div.textContent += text;
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  if(role==="bot" && clear) chatHistory.push("Bot: " + text);
  else if(role==="user" && clear) chatHistory.push("You: " + text);
}

form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  const question = input.value.trim();
  if(!question) return;
  addMessage(question,"user");
  input.value="";

  try{
    const formData = new FormData();
    formData.append("question",question);

    const res = await fetch("http://127.0.0.1:8000/ask",{
      method:"POST",
      body:formData
    });

    const data = await res.json();
    let answer = data.answer;
    let i=0;
    function typeWriter(){
      if(i<answer.length){
        addMessage(answer[i],"bot",i===0?true:false);
        i++;
        setTimeout(typeWriter,30);
      }
    }
    typeWriter();

  }catch(err){
    addMessage("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….","bot");
    console.error(err);
  }
});

input.addEventListener("keydown",(e)=>{
  if(e.key==="Enter") form.dispatchEvent(new Event("submit"));
});

// ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª Ù„Ù„Ø¨ÙˆØª
speakBtn.addEventListener("click",()=>{
  const lastBotMsg = chatHistory.filter(m=>m.startsWith("Bot:")).pop();
  if(!lastBotMsg) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¨ÙˆØª Ø¨Ø¹Ø¯.");
  const utterance = new SpeechSynthesisUtterance(lastBotMsg.replace("Bot: ",""));
  utterance.lang="ar-SA";
  speechSynthesis.speak(utterance);
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
downloadBtn.addEventListener("click",()=>{
  if(chatHistory.length===0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¯Ø«Ø© Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§.");
  const blob = new Blob([chatHistory.join("\n")],{type:"text/plain;charset=utf-8"});
  const a=document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download="chat_history.txt";
  a.click();
  URL.revokeObjectURL(a.href);
});
</script>
</body>
</html>
